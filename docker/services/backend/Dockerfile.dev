# ğŸ”¹ Oficjalny obraz Go
FROM golang:1.24

WORKDIR /app

# ğŸ”¹ Instalacja curl, git i unzip (potrzebne do Task/Air)
RUN apt-get update && apt-get install -y curl unzip git && rm -rf /var/lib/apt/lists/*

# ğŸ”¹ Instalacja Task
RUN curl -sSfL https://taskfile.dev/install.sh | sh -s -- -b /usr/local/bin

# ğŸ”¹ Instalacja Air (hot reload dla Go)
RUN curl -sSfL https://raw.githubusercontent.com/cosmtrek/air/master/install.sh | sh -s -- -b /usr/local/bin

# ğŸ”¹ Kopiujemy moduÅ‚y i instalujemy zaleÅ¼noÅ›ci
COPY ./backend/go.mod ./backend/go.sum ./
RUN go mod download

# ğŸ”¹ Kopiujemy resztÄ™ kodu
COPY ./backend/ .
COPY ./docker/services/backend/entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# ğŸ”¹ Port aplikacji
EXPOSE 8080

ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]

# ğŸ”¹ DomyÅ›lny CMD: run targetu (webserver lub consumer)
CMD ["task", "run"]
